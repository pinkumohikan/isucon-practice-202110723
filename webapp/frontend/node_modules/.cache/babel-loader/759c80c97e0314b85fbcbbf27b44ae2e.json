{"remainingRequest":"/opt/frontend/node_modules/thread-loader/dist/cjs.js!/opt/frontend/node_modules/babel-loader/lib/index.js!/opt/frontend/node_modules/cache-loader/dist/cjs.js??ref--0-0!/opt/frontend/node_modules/vue-loader/lib/index.js??vue-loader-options!/opt/frontend/src/views/Seats.vue?vue&type=script&lang=js&","dependencies":[{"path":"/opt/frontend/src/views/Seats.vue","mtime":1621475513321},{"path":"/opt/frontend/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/opt/frontend/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/opt/frontend/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/opt/frontend/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/opt/frontend/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.regexp.search\";\nimport \"core-js/modules/es6.string.iterator\";\nimport \"core-js/modules/es6.array.from\";\nimport \"core-js/modules/es6.object.keys\";\nimport \"core-js/modules/web.dom.iterable\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport Router from '@/router.js';\nimport TrainItem from '@/components/Trains/TrainItem.vue';\nimport { apiService } from \"../services/api.js\";\nexport default {\n  data: function data() {\n    return {\n      year: null,\n      month: null,\n      day: null,\n      train_class: \"\",\n      train_name: \"\",\n      car_number: 1,\n      from_station: null,\n      to_station: null,\n      adult: null,\n      child: null,\n      seat_class: \"\",\n      seatCols: [],\n      cars: [],\n      next_car_number: null\n    };\n  },\n  components: {},\n  computed: {\n    seat_class_name: function seat_class_name() {\n      var m = {\n        premium: \"プレミアム\",\n        reserved: \"普通席\",\n        \"\": \"\"\n      };\n      return m[this.seat_class];\n    },\n    selectableCars: function selectableCars() {\n      var _this = this;\n\n      return this.cars.filter(function (car) {\n        return car.seat_class == _this.seat_class;\n      });\n    },\n    condition: function condition() {\n      return {\n        year: this.year,\n        month: this.month,\n        day: this.day,\n        train_class: this.train_class,\n        train_name: this.train_name,\n        car_number: this.car_number,\n        from_station: this.from_station,\n        to_station: this.to_station\n      };\n    },\n    selectedSeats: function selectedSeats() {\n      var ret = [];\n      Object.keys(this.seatCols).forEach(function (key) {\n        var col = this[key];\n        ret = ret.concat(col.seats.filter(function (seat) {\n          return seat.selected;\n        }));\n      }, this.seatCols);\n      return ret;\n    },\n    totalCount: function totalCount() {\n      return this.adult + this.child;\n    },\n    selectedCount: function selectedCount() {\n      return this.selectedSeats.length;\n    },\n    availableCount: function availableCount() {\n      return this.totalCount - this.selectedCount;\n    },\n    filled: function filled() {\n      return this.availableCount <= 0;\n    }\n  },\n  methods: {\n    selectSeat: function selectSeat(seat) {\n      if (this.availableCount <= 0 && !seat.selected) {\n        return;\n      }\n\n      if (seat.text != \"○\") {\n        return;\n      }\n\n      seat.selected = !seat.selected;\n      var s = Array.from(this.seatCols);\n      this.seatCols = [];\n      this.seatCols = s;\n    },\n    search: function search() {\n      var _this2 = this;\n\n      this.seats = [];\n      this.cars = [];\n      apiService.getSeats(this.condition).then(function (res) {\n        _this2.seats = res[\"seats\"];\n        _this2.cars = res[\"cars\"];\n        var self = _this2;\n        var ret = [];\n        var cols = {};\n        cols[\"A\"] = {\n          name: \"A\",\n          seats: []\n        };\n        cols[\"B\"] = {\n          name: \"B\",\n          seats: []\n        };\n        cols[\"C\"] = {\n          name: \"C\",\n          seats: []\n        };\n        cols[\"D\"] = {\n          name: \"D\",\n          seats: []\n        };\n        cols[\"E\"] = {\n          name: \"E\",\n          seats: []\n        };\n\n        _this2.seats.forEach(function (seat) {\n          seat.text = \"○\";\n          seat.disabled = false;\n          seat.selected = false;\n\n          if (seat.is_occupied) {\n            seat.text = \"×\";\n            seat.disabled = true;\n          }\n\n          if (seat.class != self.seat_class) {\n            seat.text = \"-\";\n            seat.disabled = true;\n          }\n\n          cols[seat.column][\"seats\"].push(seat);\n        });\n\n        if (cols[\"A\"].seats.length > 0) ret.push(cols[\"A\"]);\n        if (cols[\"B\"].seats.length > 0) ret.push(cols[\"B\"]);\n        if (cols[\"C\"].seats.length > 0) ret.push(cols[\"C\"]);\n        if (cols[\"D\"].seats.length > 0) ret.push(cols[\"D\"]);\n        if (cols[\"E\"].seats.length > 0) ret.push(cols[\"E\"]);\n        console.log(ret);\n        _this2.seatCols = ret;\n      });\n    },\n    changeCar: function changeCar(car_number) {\n      console.log(car_number);\n      car_number = parseInt(car_number);\n      var query = {\n        year: this.year,\n        month: this.month,\n        day: this.day,\n        train_class: this.train_class,\n        train_name: this.train_name,\n        car_number: car_number,\n        from_station: this.from_station,\n        to_station: this.to_station,\n        adult: this.adult,\n        child: this.child,\n        seat_class: this.seat_class\n      };\n      Router.push({\n        path: '/reservation/seats',\n        query: query\n      });\n      this.car_number = car_number;\n      this.search();\n    },\n    reserve: function reserve() {\n      var condition = {\n        year: this.year,\n        month: this.month,\n        day: this.day,\n        train_class: this.train_class,\n        train_name: this.train_name,\n        car_number: this.car_number,\n        from_station: this.from_station,\n        to_station: this.to_station,\n        adult: this.adult,\n        child: this.child,\n        seat_class: this.seat_class,\n        seats: this.selectedSeats,\n        column: \"\"\n      };\n      apiService.reserve(condition).then(function (res) {\n        var query = {\n          reservation_id: res.reservation_id\n        };\n        Router.push({\n          path: '/reservation/payment',\n          query: query\n        });\n      });\n    }\n  },\n  mounted: function mounted() {\n    this.year = parseInt(this.$route.query.year);\n    this.month = parseInt(this.$route.query.month);\n    this.day = parseInt(this.$route.query.day);\n    this.train_class = this.$route.query.train_class;\n    this.train_name = this.$route.query.train_name;\n    this.car_number = parseInt(this.$route.query.car_number);\n    this.adult = parseInt(this.$route.query.adult);\n    this.child = parseInt(this.$route.query.child);\n    this.from_station = this.$route.query.from_station;\n    this.to_station = this.$route.query.to_station;\n    this.seat_class = this.$route.query.seat_class;\n    this.next_car_number = this.car_number;\n    return this.search();\n  }\n};",null]}