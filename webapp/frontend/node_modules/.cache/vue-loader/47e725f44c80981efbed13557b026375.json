{"remainingRequest":"/opt/frontend/node_modules/vue-loader/lib/index.js??vue-loader-options!/opt/frontend/src/views/Seats.vue?vue&type=script&lang=js&","dependencies":[{"path":"/opt/frontend/src/views/Seats.vue","mtime":1621475513321},{"path":"/opt/frontend/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/opt/frontend/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/opt/frontend/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/opt/frontend/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/opt/frontend/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport Router from '@/router.js'\nimport TrainItem from '@/components/Trains/TrainItem.vue'\nimport { apiService } from '../services/api.js'\n\nexport default {\n  data: function() {\n    return {\n      year: null,\n      month: null,\n      day: null,\n      train_class: \"\",\n      train_name: \"\",\n      car_number: 1,\n      from_station: null,\n      to_station: null,\n      adult: null,\n      child: null,\n      seat_class: \"\",\n      seatCols: [],\n      cars: [],\n      next_car_number: null,\n    }\n  },\n  components: {},\n  computed: {\n    seat_class_name () {\n      var m = {\n        premium: \"プレミアム\",\n        reserved: \"普通席\",\n        \"\": \"\",\n      }\n      return m[this.seat_class]\n    },\n    selectableCars () {\n      return this.cars.filter(car => car.seat_class == this.seat_class)\n    },\n    condition () {\n      return {\n        year: this.year,\n        month: this.month,\n        day: this.day,\n        train_class: this.train_class,\n        train_name: this.train_name,\n        car_number: this.car_number,\n        from_station: this.from_station,\n        to_station: this.to_station,\n      }\n    },\n    selectedSeats () {\n      var ret = []\n      Object.keys(this.seatCols).forEach(function(key) {\n        var col = this[key];\n        ret = ret.concat(col.seats.filter(seat => seat.selected));\n      }, this.seatCols);\n      return ret\n    },\n    totalCount () {\n      return this.adult + this.child\n    },\n    selectedCount () {\n      return this.selectedSeats.length\n    },\n    availableCount () {\n      return this.totalCount - this.selectedCount\n    },\n    filled () {\n      return this.availableCount <= 0\n    }\n  },\n  methods: {\n    selectSeat (seat) {\n      if (this.availableCount <= 0 && !seat.selected){\n        return\n      }\n\n      if (seat.text != \"○\") {\n        return\n      }\n\n      seat.selected = !seat.selected\n      var s = Array.from(this.seatCols)\n      this.seatCols = []\n      this.seatCols = s\n    },\n    search() {\n      this.seats = []\n      this.cars = []\n      apiService.getSeats(this.condition).then((res) => {\n        this.seats = res[\"seats\"]\n        this.cars = res[\"cars\"]\n\n        var self = this\n        var ret = []\n        var cols = {}\n\n        cols[\"A\"] = {name: \"A\", seats:[]}\n        cols[\"B\"] = {name: \"B\", seats:[]}\n        cols[\"C\"] = {name: \"C\", seats:[]}\n        cols[\"D\"] = {name: \"D\", seats:[]}\n        cols[\"E\"] = {name: \"E\", seats:[]}\n\n        this.seats.forEach(function(seat){\n          seat.text = \"○\"\n          seat.disabled = false\n          seat.selected = false\n\n          if(seat.is_occupied){\n            seat.text = \"×\"\n            seat.disabled = true\n\n          }\n          if(seat.class != self.seat_class){\n            seat.text = \"-\"\n            seat.disabled = true\n          }\n\n          cols[seat.column][\"seats\"].push(seat)\n        })\n\n        if(cols[\"A\"].seats.length>0)\n          ret.push(cols[\"A\"])\n        if(cols[\"B\"].seats.length>0)\n          ret.push(cols[\"B\"])\n        if(cols[\"C\"].seats.length>0)\n          ret.push(cols[\"C\"])\n        if(cols[\"D\"].seats.length>0)\n          ret.push(cols[\"D\"])\n        if(cols[\"E\"].seats.length>0)\n          ret.push(cols[\"E\"])\n        console.log(ret)\n        this.seatCols = ret\n\n      })\n    },\n    changeCar (car_number) {\n      console.log(car_number)\n      car_number = parseInt(car_number)\n      var query = {\n        year: this.year,\n        month: this.month,\n        day: this.day,\n        train_class: this.train_class,\n        train_name: this.train_name,\n        car_number: car_number,\n        from_station: this.from_station,\n        to_station: this.to_station,\n        adult: this.adult,\n        child: this.child,\n        seat_class: this.seat_class\n      }\n      Router.push({ path: '/reservation/seats', query: query})\n      this.car_number = car_number\n      this.search()\n    },\n    reserve () {\n      var condition = {\n        year: this.year,\n        month: this.month,\n        day: this.day,\n        train_class: this.train_class,\n        train_name: this.train_name,\n        car_number: this.car_number,\n        from_station: this.from_station,\n        to_station: this.to_station,\n        adult: this.adult,\n        child: this.child,\n        seat_class: this.seat_class,\n        seats: this.selectedSeats,\n        column: \"\",\n      }\n\n      apiService.reserve(condition).then((res) => {\n        var query = {\n          reservation_id: res.reservation_id,\n        }\n        Router.push({ path: '/reservation/payment', query: query})\n      })\n    }\n  },\n  mounted() {\n    this.year = parseInt(this.$route.query.year)\n    this.month = parseInt(this.$route.query.month)\n    this.day = parseInt(this.$route.query.day)\n    this.train_class = this.$route.query.train_class\n    this.train_name = this.$route.query.train_name\n    this.car_number = parseInt(this.$route.query.car_number)\n    this.adult = parseInt(this.$route.query.adult)\n    this.child = parseInt(this.$route.query.child)\n    this.from_station = this.$route.query.from_station\n    this.to_station = this.$route.query.to_station\n    this.seat_class = this.$route.query.seat_class\n    this.next_car_number = this.car_number\n    return this.search();\n  }\n}\n",null]}